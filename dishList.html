<!DOCTYPE html>
<html>
<head>
	<title>Grocery 2.0 | DishList</title>
	<meta charset="utf-8" />
	<link rel="icon" type="image/png" href="assets/img/favicon.ico">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

<!-- 	<title>Light Bootstrap Dashboard by Creative Tim</title> -->
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
	<meta name="viewport" content="width=device-width" />
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
	<!-- Bootstrap core CSS     -->
	<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
	<link href="assets/css/admin.css" rel="stylesheet" />

	<!-- Animation library for notifications   -->
	<link href="assets/css/animate.min.css" rel="stylesheet"/>

	<!--  Light Bootstrap Table core CSS    -->
	<link href="assets/css/light-bootstrap-dashboard.css" rel="stylesheet"/>


	<!--  CSS for Demo Purpose, don't include it in your project     -->
	<link href="assets/css/demo.css" rel="stylesheet" />


	<!--     Fonts and icons     -->
	<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
	<link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
	<link href="assets/css/pe-icon-7-stroke.css" rel="stylesheet" />
	<link rel="stylesheet" href="http://css-spinners.com/css/spinner/spinner.css" type="text/css">
	<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/aes.js"></script>
	<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/tripledes.js"></script>
	
	<script src="assets/js/jquery-1.10.2.js" type="text/javascript"></script>
	<script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>
	
	<script src="assets/js/main.js"></script>
	<script type="text/javascript">
		function getQueryParams(qs) {
			qs = qs.split('+').join(' ');

			var params = {},
			tokens,
			re = /[?&]?([^=]+)=([^&]*)/g;

			while (tokens = re.exec(qs)) {
				params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
			}

			return params;
		}
		function checkUser(){
			try{
				var username = getQueryParams(document.location.search).username.toString();
				username = username.split(':');
				value = username[1];
				username = username[0];
				if(value != 'true'){
					window.location.href = "index.html"
				}
				// console.log(typeof(username));
				findUserForEmail(username, function(user){
					try{
						var isAdmin = user[0].get('isAdmin');
						if(isAdmin != true){
							window.location.href = "index.html";
						}
					}
					catch(e){
						window.location.href='index.html';
					}
				});
			}
			catch(e){
				window.location.href = "index.html"
			}
		}
		checkUser();
	</script>
	<script src="assets/js/admin.js"></script>
	<script src="assets/js/bootbox.min.js"></script>

	<style  type="text/css">
		body, p, div, tr, td{
			font-family: 'Montserrat';
		}
		.inputButton, .inputButton:hover {
			background : white !important;
			color: black;
		}

	</style>
</head>
<body>
	<div class="wrapper">
		<div class="navbar navbar-inverse">
			<div class="navbar-header">
				<a class="navbar-brand" href="#">Grocery 2.0</a>
			</div>
			<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav navbar-left">
					<li>
						<a href="user.html">
							Users
						</a>
					</li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li>
						<a href="#" id="admin">Hello Admin<span class="LOGOUT"> Logout</span></a>
					</li>
				</ul>
			</div>
		</div>
		<div class="container">

			<!-- Main row dividing right and left part into columns -->
			<div class="row">

				<!-- The left column of dishes starts here -->
				<div class="col-md-4" style="border-right: 1px solid grey">
					
					<div class="card panel panel-default box-shadow--8dp" id="availableDishes">
						<table class="table table-hover table-striped">
							<thead>
								<tr>
									<th>
										<b>Available Dishes</b>
									</th>
								</tr>
								
							</thead>
							<tbody>
								<tr >
									<td align="center">
										<div class="spinner-loader">
											Loadingâ€¦
										</div>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<!-- The left column containing dishes ends here -->


				<!-- Right side column containing vegetables, grocery and spices -->
				<div class="col-md-8 border-bottom">
					<h2 class="headingColor text-left selectedDishTopLeft"><b>Available Dishes</b></h2>

					<!-- The general Modal used for all -->

					<div class="modal fade" id="ingredientModal" role="dialog">
						<div class="modal-dialog modal-md">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal">&times;</button>
									<h4 class="modal-title" id="modalTitle">Select Ingredient Type</h4>
								</div>
								<div class="modal-body modalBody">
									<div class="table-responsive">
										<table id="mytable" class="table table-bordred table-striped">
											<thead>
												<tr>
													<th width="10%">
														<input type="checkbox" id="checkall">
													</th>
													<th>
														Name
													</th>
												</tr>
											</thead>
											<tbody class="modalTableBody">
												<tr>
													<td width="10%"><input type="checkbox" class="checkthis"></td>
													<td>Bhindi</td>
												</tr>
											</tbody>
										</table>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="modal-footer" style="border:0">
									<button type="button" class="btn btn-info selectIngredients" data-dismiss="modal">Select</button>
								</div>
							</div>
						</div>
					</div>


					<!-- Vegetables Part start here -->
					<div class="">
						<h3 class="headingColor"><b>Vegetables</b></h3>
					</div>
					<div class="card panel panel-default box-shadow--8dp" id="vegetablesTable">
						<table class="table table-bordered" >
							<thead>
								<tr>
									<th width="15%">
										<b>Keep</b>
									</th>
									<th width="55%">
										<b>Item</b>
									</th>
									<th>
										<b>Quantity</b>
									</th>
								</tr>
								<tr>
									<th width="25%" class="addNewItem" data-target="vegetablesModal">
										<b>Add New Item <button type="button" class="btn btn-simple btn-xs openModal" data-toggle="modal" data-target="#ingredientModal"><i class="fa fa-plus text-right"></i></button></b>
									</th>
									<th></th>
									<th></th>
								</tr>
							</thead>
							<tbody>
								<tr>

								</tr>
							</tbody>
						</table>
					</div>
					<!-- Vegetables part end here -->


					<!-- Grocery Part starts here -->
					<div class="">
						<h3 class="headingColor"><b>Grocery</b></h3>
					</div>
					<div class="card panel panel-default box-shadow--8dp" id="groceryTable">
						<table class="table table-bordered" >
							<thead>
								<tr>
									<th width="15%">
										<b>Keep</b>
									</th>
									<th width="55%">
										<b>Item</b>
									</th>
									<th>
										<b>Quantity</b>
									</th>
								</tr>
								<tr>
									<th width="25%" class="addNewItem" data-target="groceryModal">
										<b>Add New Item <button type="button" class="btn btn-simple btn-xs openModal" data-toggle="modal" data-target="#ingredientModal"><i class="fa fa-plus text-right"></i></button></b>
									</th>
									<th></th>
									<th></th>

								</tr>
							</thead>
							<tbody>
								<tr>

								</tr>
							</tbody>
						</table>
					</div>
					<!-- Grocery part ends here -->


					<!-- Spices part starts here -->
					<div class="">
						<h3 class="headingColor"><b>Spices</b></h3>
					</div>

					<div class="card panel panel-default box-shadow--8dp" id="spicesTable">
						<table class="table table-bordered" >
							<thead>
								<tr>
									<th width="15%">
										<b>Keep</b>
									</th>
									<th width="55%">
										<b>Item</b>
									</th>
									<th>
										<b>Quantity</b>
									</th>
								</tr>
								<tr>
									<th width="25%" class="addNewItem" data-target="#spicesModal">
										<b>Add New Item <button type="button" class="btn btn-simple btn-xs openModal" data-toggle="modal" data-target="#ingredientModal"><i class="fa fa-plus text-right"></i></button></b>
									</th>
									<th></th>
									<th></th>
								</tr>
							</thead>
							<tbody>
								<tr>
								</tr>
							</tbody>
						</table>
					</div>
					<!-- Spices part ends here -->

					
				</div>
				<!-- Right column ends here -->

			</div>
		</div>
	</div>
</body>
<!--   Core JS Files   -->
<script src="assets/js/bootstrap.min.js" type="text/javascript"></script>

<!--  Checkbox, Radio & Switch Plugins -->
<script src="assets/js/bootstrap-checkbox-radio-switch.js"></script>

<!--  Charts Plugin -->
<script src="assets/js/chartist.min.js"></script>

<!--  Notifications Plugin    -->
<script src="assets/js/bootstrap-notify.js"></script>

<!--  Google Maps Plugin    -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>

<!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
<script src="assets/js/light-bootstrap-dashboard.js"></script>

<!-- Light Bootstrap Table DEMO methods, don't include it in your project! -->
<script src="assets/js/demo.js"></script>

<script type="text/javascript">
	$("#checkall").val('off');



	var removeText = '<td class="td-actions text-right removeButton">' + '\n' + '<button data-original-title="Remove" type="button" rel="tooltip" class="btn btn-danger btn-simple btn-xs">' + '\n' + '<i class="fa fa-times cross"></i>' + '\n' + '</button>' + '\n' + '</td>';

	var addText = '<td class="td-actions text-right">' + '\n' + '<button data-original-title="" type="button" rel="tooltip" class="btn btn-primary btn-simple btn-xs editDish">' + '\n' + '<i class="fa fa-pencil"></i>' + '\n' + '</button>' + '<button data-original-title="" type="button" rel="tooltip" class="btn btn-danger btn-simple btn-xs deleteDish">' + '\n' + '<i class="fa fa-minus"></i>' + '\n' + '</button>' + '\n' + '</td>';

	var vegetablesItems = {};
	var groceryItems = {};
	var spicesItems = {};
	var selectedItems = {};
	var currentDish;

	startFunction(function(){

		var availableDishes = document.getElementById('availableDishes');
		var tbodyElement = availableDishes.getElementsByTagName('tbody')[0];
		var trElement = tbodyElement.getElementsByTagName('tr');

		for (var i = 0; i < trElement.length; i++) {
			trElement[i].innerHTML += addText;
		}

		newRowAtLast('availableDishes','New Dish');

		$(document).on('click', '.deleteDish',function(e){
			text = $(this).parents('tr:first').text().trim();
			selectCurrentDish($(this));
			var decision = deleteMyDish(text);
			if(decision == true){
				deleteByFading($(this));
			}
		});
		$(document).on('click', '.editDish',function(e){
			text = $(this).parents('tr:first').text().trim();
			selectCurrentDish($(this));
			editMyDish(text);
			$('.selectedDishTopLeft').html('<b> ' + text + ' </b>');
			notifySend('Added Successfully', 'info');
		});


	});

	$(document).on('click', '.removeButton', function(e){
		deleteQuantityById($(this).closest('tr').find('.item').attr('id'));
		deleteByFading($(this));
	});

	function deleteByFading(obj){
		var $killrow = obj.closest('tr');
		$killrow.fadeOut(200, function(){
			$(this).remove();
		});
		notifySend('Removed Successfully', 'danger');
	}

	$(document).on('click', '.editButton', function(e){
		editValue($(this));
	});

	$(document).on('click', '.openModal', function(e){

		if($("#checkall").val() == 'on'){
			$("#checkall").click();
		}

		var tableType = $(this).closest('div').attr('id');
		var ingredient;
		switch(tableType){
			case 'vegetablesTable':
			ingredient = 'Vegetables';
			break;

			case 'spicesTable':
			ingredient = 'Spices';
			break;

			case 'groceryTable':
			ingredient = 'Grocery';
			break;
		}

		if(ingredient!=undefined){
			var $node = $('#ingredientModal');
			console.log("hell");
			//Set title
			$node.find('#modalTitle').html('Select ' + ingredient);
			var quantities = getAllIngredientsArray(ingredient);
			var modalContent = ""
			for (var i = 0; i < quantities.length; i++) {
				var name = quantities[i]['name'];
				var id = quantities[i]['id'];
				var unit = quantities[i]['unit'];
				modalContent+='<tr>\n<td width="10%"><input type="checkbox" class="checkthis"></td>\n<td class="ingredientName" value="' + id + '" unit="' +unit + '"> ' + name + '</td>\n</tr>';
			};
			$('.modalTableBody').html(modalContent);
			// display(quantities);
		}
	});

$("#checkall").click(function(){
	var onOrOff = $(this).val();
	if(onOrOff == "off"){
		$('.modalTableBody tr').find('.checkthis').click();
		$(this).val('on');
	}
	else{
		$(this).val('off');
	}
});

$(document).on('click', '.LOGOUT', function(e){
	
	try{
		Parse.User.logout();
	}
	catch(e){

	}
	notifySend("Thanks for using Grocery 2.0", 'warning');
	setTimeout(function(){
		window.location.href="index.html";
	}, 2500);

});

$('.selectIngredients').click(function(){
	var type = $('#modalTitle').html().trim();
	type = type.replace('Select ', '');
	type = type.toLowerCase() + 'Table';

	var $allInputs = $('.modalTableBody').find('input[type="checkbox"]:checked');
	$allInputs.each(function(){
		var ingredientName = $(this).closest('tr').find('td:nth-child(2)').html().trim();
		var amount = '1';
		var unitDisplayString = $(this).closest('tr').find('td:nth-child(2)').attr('unit');
		var id = $(this).closest('tr').find('td:nth-child(2)').attr('value');
		addIngredient({'ingredientName': ingredientName, 'amount': amount, 'unitDisplayString': unitDisplayString, 'id': id},null,type,true);
	});
});

$(document).on('click','.appendInTable', function(e){
	bootbox.prompt("Please enter name for the new dish", function(result){
		if(result == null){
			console.log("Not a valid input")
			return ;
		}
		else{
			createDish(result, [], function(){
				notifySend("Successfully added new dish " + result, 'info');
				// showNewlyAddedDish();
				setTimeout(function(){
					location.reload();
				}, 750)
			}, function(){
				console.log("Error in creating new dish")
			});

		}
	})
});

var img = 0;

</script>
</html>
